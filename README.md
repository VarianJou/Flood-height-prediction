# Flood Height Prediction

Machine learning pipeline for predicting flood depths using remote sensing and environmental data.

## Overview

This project predicts flood heights by combining:
- Landscape and vegetation metrics from satellite data
- Topographic features from elevation models  
- Weather and soil moisture data
- SAR imagery from Sentinel-1

The pipeline extracts features around flood locations, processes multiple data sources, and trains ML models to predict flood depths.

## Repository Structure

- **`data/`** - Processed datasets and model outputs
- **`routing/`** - Neural network routing algorithms  
- **`notebooks/`** - Feature extraction scripts
- **`figures/`** - Visualizations and analysis results

## Main Scripts/Notebooks

- **`data_exploration.ipynb`** - Data merging, imputation, and UMAP clustering
- **`modelling.ipynb`** - Random Forest training and evaluation
- **`utils.py`** - Data processing and visualization utilities
- **`notebooks/NLCD_Extract_v0.1.0.py`** - Extract landscape features from satellite data
- **`notebooks/Calculate_HWM_Depth_v1.0.ipynb`** - Calculate flood depth targets
- **`notebooks/Sentinel_Features.ipynb`** - Extract SAR imagery features
- **`notebooks/dem_features.ipynb`** - Extract topographic features

## Input and Output Files

### External Input Files (Not in Repository)
| File | Source | Description |
|------|--------|-------------|
| **filtered_flooding_points_over_one_day*.shp** | USGS | High water mark points with ID, peak_date, elev_ft, and geometry attributes |
| **Annual_NLCD_ImpDsc_{YEAR}_CU_C1V1.tif** | USGS National Land Cover Database | Annual impervious surface data (2016-2024), 30m resolution |
| **Annual_NLCD_LndCov_{YEAR}_CU_C1V1.tif** | USGS National Land Cover Database | Annual land cover/vegetation data (2016-2024), 30m resolution |
| **{ID}_USGS_3DEP_{YEAR}.tif** | USGS 3DEP | Individual DEM raster files by flood point ID and year, 10m resolution |
| **{ID}_S1_*.tif** | Google Earth Engine/ESA | Sentinel-1 SAR imagery with VV and VH polarizations |
| **CHIRPS_1day_ahead/*.tif** | CHIRPS/UCSB | 1-day ahead precipitation forecasts, 0.05Â° resolution |
| **Flooding_SMAP9KM_{TIME}/*.tif** | NASA SMAP | 9km soil moisture data at various time intervals before flood events |

### Output Data Files (In Repository)

#### `data/` Directory
| File | Generated By | Description |
|------|-------------|-------------|
| **combined_features.csv** | data_exploration.ipynb | Main dataset with KNN imputation, 1147 samples, 60+ features |
| **combined_nlcd_features.csv** | NLCD_Extract_v0.1.0.py | NLCD features including impervious surface and vegetation analysis (25 features) |
| **dem_features.csv** | dem_features.ipynb | DEM-derived topographic features at 10m resolution |
| **dem_1m_features.csv** | dem_features.ipynb | High-resolution DEM features at 1m resolution |
| **HWM_Depth_m.csv** | Calculate_HWM_Depth_v1.0.ipynb | High water mark depth measurements (target variable) |
| **soil_moisture.csv** | soil_moisture_data_process.py | Multi-temporal SMAP soil moisture data |
| **Weather_Data.csv** | External processing | Weather features (temperature, humidity, wind, pressure) |
| **precipitation.csv** | External source | CHIRPS precipitation data with 1-day ahead forecasts |
| **sentinel1_combined_features.csv** | Sentinel_Features.ipynb | Sentinel-1 SAR backscatter features |
| **rf_feature_importance.csv** | modelling.ipynb | Random Forest feature importance rankings |
| **rf_residuals.csv** | modelling.ipynb | Residual analysis with point IDs |

#### `figures/` Directory
| File | Generated By | Description |
|------|-------------|-------------|
| **Input_Clustering_Results/silhouette_scores.csv** | data_exploration.ipynb | Silhouette scores for clustering analysis |
| **Input_Clustering_Results/silhouette_scores.png** | data_exploration.ipynb | Silhouette score visualization |
| **Input_Clustering_Results/umap_k{2-10}.png** | data_exploration.ipynb | UMAP scatter plots by cluster assignments |
| **Input_Clustering_Results/umap_embedding_and_labels.csv** | data_exploration.ipynb | UMAP 2D embeddings with cluster labels |

## Variables

### combined_nlcd_features.csv
- `ID`, `peak_date`, `nlcd_year`, `total_area_km2`
- `pct_area_1`, `pct_area_2`, `area_km_1`, `area_km_2`, `cai_1`, `cai_2`
- `pct_area_forest`, `pct_area_shrubland`, `pct_area_herbaceous`, `pct_area_planted`, `pct_area_wetlands`
- `area_km_forest`, `area_km_shrubland`, `area_km_herbaceous`, `area_km_planted`, `area_km_wetlands`
- `cai_forest`, `cai_shrubland`, `cai_herbaceous`, `cai_planted`, `cai_wetlands`

### combined_features.csv
All variables from above datasets plus:
- `year`, `month_sin`, `day_sin`, `hour_sin`
- `dem_min`, `dem_max`, `dem_mean`, `dem_iqr`
- Weather: temperature, humidity, wind speed, pressure, heat index, feels-like temperature
- Soil moisture: multi-temporal SMAP data
- SAR: Sentinel-1 VV/VH backscatter statistics and ratios
- Target: `height_above`

### dem_features.csv
- `file_id`, `year`, `dem_min`, `dem_max`, `dem_mean`, `dem_iqr`, `projection`

### HWM_Depth_m.csv
- `ID`, `Year`, `height_above`

### sentinel1_combined_features.csv
- `ID`, `peak_date`
- `VV_Min`, `VV_Max`, `VV_Mean`, `VV_IQR`, `VV_SD`
- `VH_Min`, `VH_Max`, `VH_Mean`, `VH_IQR`, `VH_SD`
- `VH_VV_Ratio`

### precipitation.csv
- `ID`, `S1_Date`, `precipitation`
